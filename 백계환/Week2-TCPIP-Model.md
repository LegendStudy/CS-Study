# 2.2 TCP/IP 4계층 모델

## 2.2.1 계층 구조


계층들은 특정 계층이 변경되었을 때 다른 계층이 영향을 받지 않도록 설계되었다. 

### 1️⃣ 애플리케이션 계층

애플리케이션 계층은 FTP, HTTP, SSH, DSN 등 응용 프로그램이 사용되는 프로토콜 계층이며 웹 서비스, 이메일 등 서비스를 실질적으로 사람들에게 제공하는 층이다.

- FTP: 장치와 장치 간의 파일을 전송하는 데 사용되는 표준 통신 프로토콜
- SSH: 보안되지 않은 네트워크 서비스를 안전하게 운영하기 위한 암호화 네트워크 프로토콜
- HTTP: World Wide Web을 위한 데이터 통신의 기초이자 웹 사이트를 이용하는 데 쓰는 프로토콜
- SMTP: 전자 메일 전송을 위한 인터넷 표준 통신 프로토콜
- DNS: 도메인 이름과 IP 주소를 매핑해주는 서버

### 2️⃣ 전송 계층

전송 계층은 송신자와 수신자를 연결하는 통신 서비스를 제공하며 연결 지향 데이터 스트림 지원, 신뢰성, 흐름 제어를 제공할 수 있다. 애플리케이션과 인터넷 계층 사이의 데이터가 전달될 때 중계 역할을 한다. 

주요 목표는 **데이터가 소스에서 목적지 응용 프로그램까지** 안정적이고 효율적으로 이동하도록 하는 것입니다.

전송계층은 패킷의 분할 및 재조합, 오류 검사 및 복구, 흐름 제어 및 혼잡 제어 등을 수행합니다.

대표적으로 TCP, UDP가 있다.

**TCP**(Transmission Control Protocol)

- 패킷 사이의 순서를 보장하고 연결지향 프로토콜을 사용
- 신뢰성
- 가상회선 패킷 교환 방식

**UDP**(User Datagram Protocol)

- 패킷 사이의 순서 보장 X
- 수신 여부를 확인하지 않음
- 데이터그램 패킷 교환 방식

> **TCP 연결 성립 과정** (connection establishment)
> 

3-way handshake


1. SYN: 클라이언트는 서버에 ISN을 담아 SYN을 보낸다. 
2. SYN + ACK: 서버는 클라이언트의 SYN을 수신하고 서버의 ISN을 보내고 승인번호를 보낸다.
3. ACK: 클라언트는 서버에 ACK를 보낸다.

> **TCP 연결 해제 과정**
> 

4-way handshake


- TIME_WAIT: 소켓이 바로 소멸되지 않고 일정 시간 유지되는 상태
    
    왜 일정 시간 뒤에 연결을 닫을까?
    
    1. 지연 패킷이 발생할 경우 대비, 데이터 무결성 문제 해결
    2. 두 장치가 연결이 닫혔는지 확인하기 위해

### 3️⃣ 인터넷(네트워크) 계층

인터넷 계층은 장치로부터 받은 네트워크 패킷을 IP 주소로 지정된 목적지로 전송하기 위해 사용되는 계층이다.

IP, ARP, ICMP 등이 있으며 패킷을 수신해야 할 상대의 주소를 지정하여 데이터를 전달한다. 

상대방이 제대로 받았는지에 대해 보장하지 않는 비연결형적 특징

이 계층의 주요 목표는 ***데이터 패킷을 소스 호스트에서 목적지 호스트까지 전달하는 것***이다. 

> **주요 기능**
> 
1. **라우팅 (Routing)**:
    - 네트워크 계층은 데이터 패킷이 네트워크를 통해 이동할 경로를 결정한다. 이를 위해 라우터들 사이에서 라우팅 프로토콜(예: OSPF, BGP)을 사용하여 최적의 경로를 찾고 패킷을 목적지까지 전달한다.
2. **패킷 전달 (Packet Forwarding)**:
    - 라우팅 테이블을 기반으로 패킷을 적절한 출력 링크로 전달하는 기능을 한다. 이 과정에서 각 라우터는 수신된 패킷의 목적지 주소를 확인하고 다음 라우터나 목적지로 패킷을 전달한다.

### 4️⃣ 링크 계층

특정 네트워크 링크(예: 이더넷, Wi-Fi) 위에서 데이터의 전송을 담당합니다. 이 계층은 **물리적 매체(전선, 광섬유, 무선)를 통한 데이터의 직접적인 전송**을 관리한다.

주요 역할은 네트워크 장치 간의 물리적 연결을 통해 프레임을 전송하는 것이다. 이를 위해 링크 계층은 프레임에 물리적 주소(일반적으로 **MAC 주소**)를 할당한다.

이 계층은 네트워크의 물리적 구성요소 간의 상호 작용을 담당하므로, 링크 계층에서 일어나는 오류는 주로 물리적 오류이다.

> **유선 LAN**
> 

전이중화 통신을 사용. 양쪽 장치가 동시에 송수신할 수 있다. 송신로와 수신로로 나눠서 데이터를 주고받는다.

현대의 고속 이더넷은 이 방식을 기반으로 통신한다.

유선 LAN을 이루는 케이블은 트위스트 페어 케이블(LAN 케이블)과 광섬유 케이블이 대표적이다.

> **무선 LAN**
> 

수신과 송신에 같은 채널을 사용하기 때문에 반이중화 통신을 사용한다. 따라서 동시에 통신할 수 없다.

무선 LAN(**WLAN**, Wireless Local Area Network)은 무선 신호 전달 방식을 이용하여 2대 이상의 장치를 연결하는 기술이다.

비유도 매체인 공기에 주파수를 쏘아 무선 통신망 구축

무선 LAN을 이용한 기술로는 와이파이, 블루투스 등이 있다.

> **WIFI**
> 

와이파이는 전자기기들이 무선 LAN 신호에 연결할 수 있게 하는 기술로, 이를 사용하려면 흔히 공유기라고 부르는 무선 접촉 장치가 있어야한다. 이를 통해 유선 LAN에 흐르는 신호를 무선 LAN 신호로 바꿔주어 신호가 닿는 범위 내에서 무선 인터넷을 사용할 수 있게 된다. 

### 5️⃣ 물리 계층

물리 계층은 데이터의 전기적, 기계적, 절차적 전송을 담당한다. 주요 역할과 기능은 다음과 같습니다:

1. **비트 전송**:
    - 물리 계층은 데이터의 실제 전송을 처리합니다. 데이터는 비트(0과 1)의 형태로 변환되어 물리적 매체를 통해 전송됩니다.
2. **물리적 매체 및 연결**:
    - 이 계층은 네트워크 케이블(예: 동축 케이블, 광섬유, 트위스티드 페어)과 같은 물리적 전송 매체의 선정과 사용을 규정합니다. 또한 물리적 포트 및 커넥터(예: RJ-45, SC 커넥터)와 같은 하드웨어 연결에 대한 표준도 정의합니다.
3. **데이터 인코딩 및 신호 변환**:
    - 데이터 비트를 물리적 신호로 변환하는 과정을 담당합니다. 예를 들어, 전기 신호나 광 신호로 변환하는 방법 등이 이에 해당합니다. 이 변환 과정은 네트워크의 전송 매체와 장비의 종류에 따라 다를 수 있습니다.

### 계층 간 데이터 송수신 과정

캡슐화 + 비캡슐화

> **캡슐화**
> 

상위 계층의 헤더와 데이터를 하위 계층의 데이터 부분에 포함시키고 해당 계층의 헤더를 삽입하는 과정

> **비캡슐화**
> 

하위 계층에서 상위 계층으로 가며 각 계층의 헤더 부분을 제거하는 과정

## 2.2.2 PDU

네트워크의 어떤 계층에서 계층으로 데이터가 전달될 때 한 덩어리의 단위를 PDU(Protocol Data Unit)라고 한다.

PDU는 제어 관련 정보들이 포함된 **헤더**, 데이터를 의미하는 **페이로드**로 구성되어 있으며 계층마다 부르는 명칭이 다르다.

- **응용 계층**: 메시지
- **전송 계층**: 세그먼트(TCP), 데이터그램(UDP)
- **인터넷 계층**: 패킷
- **링크 계층**: 프레임
- **물리 계층**: 비트
